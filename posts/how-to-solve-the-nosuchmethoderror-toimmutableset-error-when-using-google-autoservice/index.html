<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:Edirin Atumah]"><meta name=description content="Introduction Whilst building a demo application showcasing google AutoService, I encountered the below error:
 java.lang.NoSuchMethodError: com.google.common.collect.ImmutableSet.toImmutableSet()Ljava/util/stream/Collector; Searching through the internet, most solutions recommended upgrading the Google Guava version but that did not resolve the problem.
The main cause of this error, was putting the wrong Autoservice dependency in the classpath.
If your POM file has the below dependency, then you are most likely get this error.
&amp;lt;/dependencies&amp;gt; &amp;lt;dependency&amp;gt; &amp;lt;groupId&amp;gt;com.google.auto.service&amp;lt;/groupId&amp;gt; &amp;lt;artifactId&amp;gt;auto-service&amp;lt;/artifactId&amp;gt; &amp;lt;version&amp;gt;1."><meta name=keywords content="Test Automation,Selenium,BDD,Cucumber,Test Framework,maven,autoservice,google,toImmutableSet"><meta name=robots content="noodp"><meta name=theme-color content="#252627"><link rel=canonical href=https://bongosway.github.io/posts/how-to-solve-the-nosuchmethoderror-toimmutableset-error-when-using-google-autoservice/><title>How to solve the NoSuchMethodError toImmutableSet() error when using Google Autoservice :: Thought before Tools</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://bongosway.github.io/main.50cff2563f52b2f25b21b53ba23f7ec17630166f7f4cf0931a9ffa7ca6de8574.css><link rel=stylesheet type=text/css href=https://bongosway.github.io/css/all.min.css><link rel=apple-touch-icon sizes=180x180 href=https://bongosway.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://bongosway.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://bongosway.github.io/favicon-16x16.png><link rel=manifest href=https://bongosway.github.io/site.webmanifest><link rel=mask-icon href=https://bongosway.github.io/safari-pinned-tab.svg color=#252627><link rel="shortcut icon" href=https://bongosway.github.io/favicon.ico><meta name=msapplication-TileColor content="#252627"><meta name=theme-color content="#252627"><meta itemprop=name content="How to solve the NoSuchMethodError toImmutableSet() error when using Google Autoservice"><meta itemprop=description content="Introduction Whilst building a demo application showcasing google AutoService, I encountered the below error:
 java.lang.NoSuchMethodError: com.google.common.collect.ImmutableSet.toImmutableSet()Ljava/util/stream/Collector; Searching through the internet, most solutions recommended upgrading the Google Guava version but that did not resolve the problem.
The main cause of this error, was putting the wrong Autoservice dependency in the classpath.
If your POM file has the below dependency, then you are most likely get this error.
</dependencies> <dependency> <groupId>com.google.auto.service</groupId> <artifactId>auto-service</artifactId> <version>1."><meta itemprop=datePublished content="2020-07-05T00:00:00+00:00"><meta itemprop=dateModified content="2020-07-05T00:00:00+00:00"><meta itemprop=wordCount content="446"><meta itemprop=image content="https://bongosway.github.io/"><meta itemprop=keywords content="maven, autoservice, google, toImmutableSet,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bongosway.github.io/"><meta name=twitter:title content="How to solve the NoSuchMethodError toImmutableSet() error when using Google Autoservice"><meta name=twitter:description content="Introduction Whilst building a demo application showcasing google AutoService, I encountered the below error:
 java.lang.NoSuchMethodError: com.google.common.collect.ImmutableSet.toImmutableSet()Ljava/util/stream/Collector; Searching through the internet, most solutions recommended upgrading the Google Guava version but that did not resolve the problem.
The main cause of this error, was putting the wrong Autoservice dependency in the classpath.
If your POM file has the below dependency, then you are most likely get this error.
</dependencies> <dependency> <groupId>com.google.auto.service</groupId> <artifactId>auto-service</artifactId> <version>1."><meta property="og:title" content="How to solve the NoSuchMethodError toImmutableSet() error when using Google Autoservice"><meta property="og:description" content="Introduction Whilst building a demo application showcasing google AutoService, I encountered the below error:
 java.lang.NoSuchMethodError: com.google.common.collect.ImmutableSet.toImmutableSet()Ljava/util/stream/Collector; Searching through the internet, most solutions recommended upgrading the Google Guava version but that did not resolve the problem.
The main cause of this error, was putting the wrong Autoservice dependency in the classpath.
If your POM file has the below dependency, then you are most likely get this error.
</dependencies> <dependency> <groupId>com.google.auto.service</groupId> <artifactId>auto-service</artifactId> <version>1."><meta property="og:type" content="article"><meta property="og:url" content="https://bongosway.github.io/posts/how-to-solve-the-nosuchmethoderror-toimmutableset-error-when-using-google-autoservice/"><meta property="og:image" content="https://bongosway.github.io/"><meta property="article:published_time" content="2020-07-05T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-05T00:00:00+00:00"><meta property="article:published_time" content="2020-07-05 00:00:00 +0000 UTC"></head><body class=dark-theme><div class=container><header class=header><span class=header__inner><a href=https://bongosway.github.io/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ cd /home/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://bongosway.github.io/posts/>Posts</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span><span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41C32.4934 41 41 32.4934 41 22 41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>3 minutes
|
<i class="fas fa-user"></i>Edirin Atumah
| <i class="fas fa-calendar-alt"></i>Jul 5, 2020</p></div><article><h1 class=post-title><a href=https://bongosway.github.io/posts/how-to-solve-the-nosuchmethoderror-toimmutableset-error-when-using-google-autoservice/>How to solve the NoSuchMethodError toImmutableSet() error when using Google Autoservice</a></h1><figcaption><h5></h5></figcaption></figure><div class=post-content><h2 id=introduction>Introduction</h2><p>Whilst building a demo application showcasing google
<a href=https://github.com/google/auto/tree/master/service>AutoService</a>, I encountered the below error:</p><pre><code> java.lang.NoSuchMethodError: com.google.common.collect.ImmutableSet.toImmutableSet()Ljava/util/stream/Collector;
</code></pre><p>Searching through the internet, most solutions recommended upgrading the <a href=https://github.com/google/guava>Google Guava</a> version but that did not resolve the problem.</p><p>The main cause of this error, was putting the wrong <code>Autoservice</code> dependency in the classpath.</p><p>If your POM file has the below dependency, then you are most likely get this error.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml> <span style=color:#f92672>&lt;/dependencies&gt;</span>
 	<span style=color:#f92672>&lt;dependency&gt;</span>
      <span style=color:#f92672>&lt;groupId&gt;</span>com.google.auto.service<span style=color:#f92672>&lt;/groupId&gt;</span>
      <span style=color:#f92672>&lt;artifactId&gt;</span>auto-service<span style=color:#f92672>&lt;/artifactId&gt;</span>
      <span style=color:#f92672>&lt;version&gt;</span>1.0-rc7<span style=color:#f92672>&lt;/version&gt;</span>
    <span style=color:#f92672>&lt;/dependency&gt;</span>
 <span style=color:#f92672>&lt;/dependencies&gt;</span>
</code></pre></div><p>In this guide, you will solve the compilation error when using <strong>AutoService</strong> on a <code>maven</code> project.</p><p>When you&rsquo;re finished, you&rsquo;ll be able to build jar files with the right
<code>META-INF/services</code> information.</p><h2 id=prerequisites>Prerequisites</h2><p>Before you begin this guide you&rsquo;ll need:</p><ul><li>Read up the difference between a maven dependency and plugin<ul><li>This <a href=https://stackoverflow.com/a/26293404>Stackoverflow Post</a> answer this question</li><li>Read Sonatype&rsquo;s book <a href=https://books.sonatype.com/mvnref-book/reference/index.html>Maven: A Complete Reference</a></li></ul></li></ul><h2 id=step-1--check-what-is-in-your-dependency-tree>Step 1 — Check what is in your dependency tree</h2><p>We need to establish what we have in our dependency tree, because maven might be pulling in a version of the jar as a transitive dependency which might not work with your project</p><p>Run the following command to see the jar file in your tree:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mvn dependency:tree

</code></pre></div><p>if the below are missing then follow step 2;</p><p><code>com.google.auto.service:auto-service:jar:&lt;version>:compile</code></p><p><code>com.google.auto.service:auto-service-annotations:jar:&lt;version>:compile</code></p><h2 id=step-2--add-autoservice-annotation-dependency-to-pom-file>Step 2 — Add AutoService Annotation Dependency to POM file</h2><p>Add the following compile-time dependency to your classpath so the project can compile and pull in the relevant classes.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;dependencies&gt;</span>
  <span style=color:#f92672>&lt;dependency&gt;</span>
    <span style=color:#f92672>&lt;groupId&gt;</span>com.google.auto.service<span style=color:#f92672>&lt;/groupId&gt;</span>
    <span style=color:#f92672>&lt;artifactId&gt;</span>auto-service-annotations<span style=color:#f92672>&lt;/artifactId&gt;</span>
    <span style=color:#f92672>&lt;version&gt;</span>${auto-service.version}<span style=color:#f92672>&lt;/version&gt;</span>
  <span style=color:#f92672>&lt;/dependency&gt;</span>
<span style=color:#f92672>&lt;/dependencies&gt;</span>
</code></pre></div><p>Run the below to ensure your project compiles:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mvn clean compile
</code></pre></div><p>Now run the package command to generate the jar file in your target directory</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mvn clean package
</code></pre></div><p>Spy the content of the Jar file to view the generated <code>AutoService metadata</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$  jar tf target/&lt;jar-filename&gt;.jar | grep META-INF/services/
</code></pre></div><p>You should not get any results.</p><p>Developers sometimes, forget to include the right metadata instructions when creating the jar file and maven will not raise any error.
This is the exact problem <code>Autoservice</code> solves for us, removing the need to tell maven of all your metadata rule.</p><p>The next step will walk you through the process of adding the processor.</p><h2 id=step-3--tell-maven-to-generate-the-metadata>Step 3 — Tell Maven to generate the Metadata</h2><p>Add the following configuration to the compiler plugin</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;plugins&gt;</span>
  <span style=color:#f92672>&lt;plugin&gt;</span>
    <span style=color:#f92672>&lt;artifactId&gt;</span>maven-compiler-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
    <span style=color:#f92672>&lt;configuration&gt;</span>
      <span style=color:#f92672>&lt;annotationProcessorPaths&gt;</span>
        <span style=color:#f92672>&lt;path&gt;</span>
          <span style=color:#f92672>&lt;groupId&gt;</span>com.google.auto.service<span style=color:#f92672>&lt;/groupId&gt;</span>
          <span style=color:#f92672>&lt;artifactId&gt;</span>auto-service<span style=color:#f92672>&lt;/artifactId&gt;</span>
          <span style=color:#f92672>&lt;version&gt;</span>${auto-service.version}<span style=color:#f92672>&lt;/version&gt;</span>
        <span style=color:#f92672>&lt;/path&gt;</span>
      <span style=color:#f92672>&lt;/annotationProcessorPaths&gt;</span>
    <span style=color:#f92672>&lt;/configuration&gt;</span>
  <span style=color:#f92672>&lt;/plugin&gt;</span>
<span style=color:#f92672>&lt;/plugins&gt;</span>
</code></pre></div><p>Now run the package again to generate the jar file in your target directory</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mvn clean package
</code></pre></div><p>Spy the content of the Jar file again, to view the generated metadata</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$  jar tf target/&lt;jar-filename&gt;.jar | grep META-INF/services/
</code></pre></div><p>Assuming our processor class is <code>org.ihq.MyAutoclass</code>, this time the output should resemble below</p><pre><code>META-INF/services/
META-INF/services/org.ihq.MyAutoclass

</code></pre><h2 id=conclusion>Conclusion</h2><p>You’ve set up <code>Google AutoService</code> with <code>Maven</code> to autogenerate metadata without compile error(s).</p></div><div class=center>&nbsp; <a href=https://twitter.com/bongosway target=_blank rel=noopener title=Twitter><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a>&nbsp;&nbsp; <a href=mailto:dumbdev@gmail.com target=_blank rel=noopener title=Email><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a>&nbsp;&nbsp; <a href=https://github.com/bongosway target=_blank rel=noopener title=Github><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>&nbsp;&nbsp; <a href=https://linkedin.com/edirinatumah target=_blank rel=noopener title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a>&nbsp;</div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://bongosway.github.io/tags/maven-autoservice-google-toimmutableset/>maven, autoservice, google, toImmutableSet</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>446 Words</p></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://bongosway.github.io/posts/should-i-remove-pageobjects-from-my-test-class/><span class=button__icon>←</span>
<span class=button__text>Should I Remove PageObjects from my Test Class?</span></a></span></div></div><div id=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"bongosway"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2020</span>
<span><a href=https://bongosway.github.io/>Edirin Atumah</a></span>
<span><a href=https://bongosway.github.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div></footer></div><script type=text/javascript src=https://bongosway.github.io/bundle.min.dc716e9092c9820b77f96da294d0120aeeb189b5bcea9752309ebea27fd53bbe6b13cffb2aca8ecf32525647ceb7001f76091de4199ac5a3caa432c070247f5b.js integrity="sha512-3HFukJLJggt3+W2ilNASCu6xibW86pdSMJ6+on/VO75rE8/7KsqOzzJSVkfOtwAfdgkd5BmaxaPKpDLAcCR/Ww=="></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-172590795-1','auto');ga('send','pageview');}</script></body></html>